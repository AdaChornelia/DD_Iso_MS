# EURASIA_ISOSCAPE

Spatial coverage : Lat = 10S - 80N, and Long 20E - 140E

## 1. Set Working Directory

```{r dir}
setwd("YOUR_DIRECTORY")
getwd()
```

## 2. Install packages and load libraries


```{r libs}
# install packages
install.packages("IsoriX", dependencies = TRUE)

# load library
library(IsoriX)
```

## 3. Data

Note: consists of 378 source_ID(data source)

```{r data}
# Load the data (aggregated)
DATA <- read.csv("EuraIsoData_agg.csv")
DATA #(contain 378 source_ID)

# turn source_ID into factor
DATA$source_ID <- as.factor(DATA$source_ID)
DATA$elev <- as.numeric(DATA$elev)
DATA
```
Note: Check data structure. There are 7 columns: source_ID<fctr>, mean_source_value<dbl>, var_source_value<dbl>, n_source_value<int>, lat<dbl>, long<dbl>, elev<dbl>. 

## 4. Fit Geostatistical Model

```{r fit geostats model}
#4.1 fit geostats models by yourself
EURASIAFIT <- isofit(data = DATA, mean_model_fix = list(elev=TRUE, lat_abs =TRUE))

save(EURASIAFIT, file = "EURASIAFIT.rda", compress = "xz")
load(file = "EURASIAFIT.rda")

#4.2 or load from the available dataset
load(file = "EuraIsoFit.rda"

# check the model-REFERS TO "AsiaFit.md" file for results
summary(EURASIAFIT)
EURASIAFIT
plot(EURASIAFIT)

```
## 5. Load Elevation Raster


```{r elev raster}
library(terra)
library(curl)

eurasia_elev <-terra::rast("elevation_world_z7_eurasia_DD.tif")
eurasia_elev

#plot 
plot(eurasia_elev)

eurasia_elev_agg <- prepraster(raster = eurasia_elev, isofit = EURASIAFIT, aggregation_factor = 4)

plot(eurasia_elev_agg)

#OPTIONAL: LOAD FROM DATABASE
eurasia_elev_agg <- terra::rast("elev_Eurasia_z7_agg4_DD.tif")
```
Note:
elevation_world_z7_eurasia_DD
elev_raster2
class       : SpatRaster 
dimensions  : 18839, 32295, 1  (nrow, ncol, nlyr)
resolution  : 0.004087283, 0.004087283  (x, y)
extent      : 14.00074, 145.9995, 6.500865, 83.50119  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source      : elevation_world_z7_eurasia.tif 
name        : elevation_world_z7_eurasia 
min value   :                     -10879 
max value   :                      19894 

aggregate: elev_Asia_z7_agg4_DD.tif
class       : SpatRaster 
dimensions  : 5355, 8299, 1  (nrow, ncol, nlyr)
resolution  : 0.015835, 0.015835  (x, y)
extent      : 14.33387, 145.7485, -11.17724, 73.61917  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source(s)   : memory
name        : elevation_world_z7_eurasia_DD 
min value   :                         0.000 
max value   :                      8150.375


## 6. Isoscape 

```{r construct the isoscape}
eurasiascape <- isoscape(raster = eurasia_elev_agg, isofit = EURASIAFIT)
```

## 7.Visualize


```{r plot mean isoscape}
#1
plot(eurasiascape)

tiff(filename = "Eurasia_isoscape_mean.tiff",
     width = 1920, 
     height = 1080, 
     res = 300)
plot(eurasiascacpe)
dev.off()

#2
plot(eurasiascape, which = "mean_residVar")

tiff(filename = "Eurasia_isoscape_mean_residVar.tiff",
     width = 1920, 
     height = 1080, 
     res = 300)
plot(eurasiascacpe, which = "mean_residVar")
dev.off()

#3
plot(eurasiascape, which = "mean_residVar")

tiff(filename = "Eurasia_isoscape_mean_residVar.tiff",
     width = 1920, 
     height = 1080, 
     res = 300)
plot(eurasiascape, which = "mean_residVar")
dev.off()

```
